---
title: "NHL_JSON"
author: "Zack Vaskalis"
date: "6/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r LoadLibraries, include=FALSE, message=FALSE, echo=TRUE}
library(tidyverse)
library(pipeR)
library(DT)
library(knitr)
library(dplyr)
library(jsonlite)
library(httr)
library(ggplot2)
#library(readr)
#library(convertr)
#library(ggplot2)
#library(bigrquery)
#library(DBI)
#library(RSQLite)
#library(tidyjson)
#library(readr)
#library(convertr)
#library(DBI)
#library(RSQLite)
```

```{r franchise, echo=TRUE}
getFranchises <- function(...){
#franchise json data.  Set up components of URL for API query using GET() function
  query_prefix <- 'https://records.nhl.com/site/api'
  query_suffix <- '/franchise'
  franchiseJSON <- GET(paste0(query_prefix,query_suffix))

#Transform Data from JSON to a data frame
  franchiseData <- fromJSON(content(franchiseJSON,"text", encoding = "UTF-8"),flatten = TRUE) 

#Rename id to franchiseID
  franchiseData <- rename(franchiseData$data, franchiseID = id)
  franchiseData

#Reorganize the data frame with columns in a more usable order
  franchiseData %>% select(mostRecentTeamId, franchiseID, teamPlaceName, teamCommonName, firstSeasonId, lastSeasonId) %>%
    arrange(teamPlaceName) %>>% (~ franchiseData)
  franchiseDT <- datatable(franchiseData, rownames = FALSE)

#Initialize franchiseSelection Table for user to be able to see correct franchise ID for functions #3 - 5.
  franchiseSelection <- franchiseData

#return datatable
  return(list(franchiseDT,invisible(franchiseSelection)))
}
```

```{r callgetFranchise, echo=TRUE}
getFranchises()[[1]]
```

```{r franchiseTotals, echo=TRUE}
#/franchise team totals json data
query_prefix <- 'https://records.nhl.com/site/api'
query_suffix <- '/franchise-team-totals'

franchiseTeamTotsJSON <- GET(paste0(query_prefix,query_suffix))

franchiseTeamTotsData <- fromJSON(content(franchiseTeamTotsJSON,"text", encoding = "UTF-8"),flatten = TRUE)

franchiseTeamTotsData <- rename(franchiseTeamTotsData$data, franchiseID = id)

franchiseTeamTotsData
 
```



```{r listOfFranchises, echo=FALSE}
invisible(getFranchises())
franchiseSelection %>% select(franchiseID, teamPlaceName, teamCommonName) %>% arrange(teamPlaceName) %>>% (~ franchiseSelection)
datatable(franchiseSelection, rownames = FALSE)
```

```{r franchiseSpecificTotals, echo=TRUE}
#Specific franchise team totals json data
query_prefix <- 'https://records.nhl.com/site/api'
query_suffix <- '/franchise-season-records?cayenneExp=franchiseId='
#Pit Penguins to TEST - need to develop as a function where this is user input
specific_franchiseID <- '17'

franchiseIDTeamTotsDataJSON <- GET(paste0(query_prefix,query_suffix,specific_franchiseID))

franchiseIDTeamTotsData <- fromJSON(content(franchiseIDTeamTotsDataJSON,"text", encoding = "UTF-8"),flatten = TRUE)

franchiseIDTeamTotsData <- rename(franchiseIDTeamTotsData$data, franchiseID = id)

franchiseIDTeamTotsData

```

```{r franchiseGoalieRecords, echo=TRUE}
#Specific franchise Goalie Records json data
query_prefix <- 'https://records.nhl.com/site/api'
query_suffix <- '/franchise-goalie-records?cayenneExp=franchiseId='
#Pit Penguins to TEST - need to develop as a function where this is user input
specific_franchiseID <- '17'

franchiseIDGoalieJSON <- GET(paste0(query_prefix,query_suffix,specific_franchiseID))

franchiseIDGoalieData <- fromJSON(content(franchiseIDGoalieJSON,"text", encoding = "UTF-8"),flatten = TRUE)

franchiseIDGoalieData <- rename(franchiseIDGoalieData$data, franchiseID = id)

franchiseIDGoalieData

```

```{r franchiseSkaterRecords, echo=TRUE}
#Specific franchise Skater Records json data
query_prefix <- 'https://records.nhl.com/site/api'
query_suffix <- '/franchise-skater-records?cayenneExp=franchiseId='
#Pit Penguins to TEST - need to develop as a function where this is user input
specific_franchiseID <- '17'

franchiseIDSkaterJSON <- GET(paste0(query_prefix,query_suffix,specific_franchiseID))

franchiseIDSkaterData <- fromJSON(content(franchiseIDSkaterJSON,"text", encoding = "UTF-8"),flatten = TRUE)

franchiseIDSkaterData <- rename(franchiseIDSkaterData$data, franchiseID = id)

franchiseIDSkaterData

```





